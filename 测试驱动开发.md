### 概述		

​		测试驱动开发是测试、开发、重构的快速循环。TDD能显著降低缺陷的发生率，也有助于改进您的设计，记录您的公共接口并防止将来出现错误。

​		当然，TDD也不是完美的。TDD很难在遗留代码库上使用；即使在新项目中使用，也需要几个月的稳定使用才能克服学习曲线。

### 有效性

​		加快对代码执行的反馈。如同IDE能够通过编译快速定位代码语法错误一样，TDD会在几秒或几十秒验证您的代码是否执行了您认为它应该执行的操作。

​		测试是从类的公共接口的角度编写的。他们关注类的行为，而不是它的实现。程序员在编写生产代码之前编写每个测试。这将有助于将注意力集中在创建易于使用而不是易于实现的程序，从而改进了程序设计。

​		TDD与生产代码拥有相同的生命周期，并充当代码的活文档。更重要的是，在每次构建中运行所有测试，确保代码继续按最初预期工作。

### 使用方式

​		要使用TDD，请遵循图中所示的”红色、绿色、重构“循环。

![test_driven_development__the_tdd_cycle](%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91.assets/test_driven_development__the_tdd_cycle.gif)

*第一步：思考*

​		思考一下您希望您的代码应该具有什么样的行为，然后考虑一个需要少于5行的代码增量，接下来考虑一个测试，也是几行代码。

第二部：红色

​		编写测试。只为当前的行为增量编写足够的代码（通常少于5行）。根据类行为及其公共接口编写代码，而不是您认为将如何实现类的内部结构。尊重封装。在最初的几个测试中，这通常意味着您编写测试时，使用尚不存在的方法和类名称。（它迫使您从类的用户而不是其实现者角度来设计类的界面。）

​		运行测试套件。这将导致一个红色的进度条。如果没有失败，或者出乎意料，以其他方式失败，则说明有问题。

第三步：绿色

​		编写生产代码以使测试通过。通常需要少于5行的代码，但不考虑设计或概念的优雅，只要能让测试通过。即使是对结果进行硬编码，也没关系，因为在稍后会进行重构。

​		运行测试，将可能得到一个绿色进度条。如果测试失败，请返回到之前已知良好的代码。如果找不到问题，请考虑擦除新代码并重试。有时最好删除新测试并以较小的增量重新开始循环。

第四步：重构

​		随着所有测试再次通过，您现在可以重构而不必担心破坏任何东西。查看代码并寻找可能的改进。

​		对于每个问题，重构代码以修复它。进行一系列非常小的重构，每次一两分钟，当然不超过五分钟，并在每个重构之后运行测试。他们应该总是通过。如果测试没有通过并且答案不是很明显，请撤销重构并返回已知良好的代码。

​		根据需要多次重构。使您的设计尽可能好，但将其限制为代码的现有行为。不要预测未来的需求。当然也不要添加任何行为。请记住，重构不应该改变应为。新行为需要失败的测试。

第五步：循环往复

​		当准备好添加新行为时，请重新开始循环。每次完成一次TDD周期时，都会添加一点点经过良好测试、设计良好的代码。TDD成功的关键是*小增量*。

#### 速度很重要

​		运行所有测试需要的时间，在TDD中，每分钟运行测试一两次。

​		缩短测试时间的一种简单方法是在TDD周期中运行一部分测试。定期运行整个测试套件以确保没有意外破坏某些东西。特别是在集成之前和影响多个类的重构期间。

​		运行子集确实会带来风险，您会在没有意识到的情况下犯错误，从而导致以后出现凡人的调试问题。高级从业者设计他们的测试以快速运行。这要求他们在三种基本类型的自动化测试之间进行权衡：

- 单元测试，以每秒数百次的速度运行

- 集中的集成测试，以每秒少量的速度运行

- 端到端测试，每次测试通常需要几秒钟

  ​	绝大多数测试应该是单元测试。一小部分应该是集成测试，只有少数应该是端到端测试。

<u>单元测试</u>

​		单元测试只关注手头的类或方法。它们完全在内存中运行，这使得他们非常快。一般能够每秒运行至少100个单元测试。

​		单元测试运行带很快。如果不快，他们就不是单元测试。

​		其他类型的测试通常伪装成单元测试。在以下情况下，测试不是单元测试：

1. 它与数据库对话

2. 它通过网络进行通信

3. 它触及文件系统

4. 你必须对你的环境做一些特殊的事情（比如编辑配置文件）才能运行它

   做这些事情的测试是集成测试，而不是单元测试。

​		创建单元测试需要良好的设计。一个高度耦合的系统使得编写单元测试变得困难。如果您在执行此操作时遇到困难或者不能使之符合上述单元测试的定义，则表明您的设计存在问题。寻求代码解耦，以便可以单独测试每个类的相关类集。

----------

​		Mock对象时用于隔离单元测试类的流行工具。您创建的模拟对象替换为与外界对话的对象。

​		小心Mock对象。它们增加了复杂性并将您的测试与代码的实现联系起来。Mock对象不该优先选择。而是尽可能不用Mock对象。

<u>重点集成测试</u>
		单元测试是不够的。在某些时候，代码必须与外界对话。您也可以为该代码使用TDD。

​		使您的代码与数据库对话、通过网络进行通信、访问文件系统或以其它方式离开其自身进程返回的测试是集成测试。最好的集成测试是专注的集成测试，它只测试与外界的一种交互。

​		<u>注</u>
​		您可以将集成测试视为检查这个系统是否正确组合在一起的测试。这称为端到端测试。

​		集成测试需要准备要测试的外部依赖项。测试每次也都应该以完全相同的方式运行。无论您运行他们的顺序或运行他们之前的机器状态如何。这对于单元测试来说很容易，但对于集成测试来说更难。

​		确保每个集成测试都可以完全独立运行。它应该设置它需要的环境。然后再恢复以前的环境。即使测试失败或抛出异常，也一定要这样做。

​		不应该有很多的集成测试。最好的集成测试有一个紧密的焦点；每个集成测试只检查程序与外部世界对话能力的一个方面。测试套件中重点集成测试的数量应该与程序具有的外部交互类型成正比，而不是与程序的整体大小成正比。（相反，单元测试的数组必须是正比于程序的整体大小。）

<u>端到端测试</u>
		在完美的世界中，单元测试和重点集成测试完美结合，让您对测试和代码充满信心。您应该能够无所畏惧的进行任何您想要的更改，并且知道如果犯了错误，测试会发现它们。

​		如何确保单元测试和集成测试完美结合？一种方法是编写端到端测试。端到端测试在系统的大部分区域进行测试，从用户界面开始（或刚好在其后面），通过业务层，接触数据库，然后返回。验收测试和功能测试是端到端测试的常见实例。

​		端到端测试可以让您对自己的代码更有信息，但他们会遇到许多问题。他们很难创建，因为他们需要容易出错和劳动笔记型的设计和拆卸程序。他们很脆弱，并且在系统的任何部分或其设置数据发生变化时往往会损坏。他们非常慢--它们在每次测试中运行几秒钟甚至几分钟。而不是每秒进行多次测试。它们提供了一种错误的安全感，因为在代码中使用了如此多的分支，以至于很淡说代码的哪些部分被覆盖了。

​		使用探索性测试来检查单元和集成测试的有效性。而不是端到端测试。当探索性测试发现问题时，使用该信息改进单元和集成测试方法，而不是引入端到端测试。

​		<u>注</u>
​		不要使用探索性测试来发现错误；使用它来确定单元测试和集成测试是否正确匹配。当发现问题时，改进你的TDD策略。

​		在某些情况下，设计中的限制可能会阻止单元和集成测试充分测试您的代码。当你拥有遗留代码时更是如此。在这种情况下，端到端测试时必要的。

### 问题

<u>使用TDD时需要测试什么？</u>

​		几乎所有都需要测试，唯一例外的是没有任何逻辑的代码，例如丹麦的getter,setter，或者只调用另外一个方法的方法。也并不需要测试第三方代码，除非你有一些理由不信任它。



原文链接：http://www.jamesshore.com/v2/books/aoad1/test_driven_development

